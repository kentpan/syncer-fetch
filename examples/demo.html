<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syncer Fetch 演示</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: auto;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-wrap: break-word;
            word-break: break-all;
            white-space: normal;
        }

        .section {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Syncer Fetch (ES Module) 演示</h1>
        <p>此页面演示了如何作为 ES Module 导入并使用构建后的库。</p>
        <p><strong>注意：</strong> 由于浏览器的CORS策略，您必须通过HTTP服务器访问此页面，而不是直接打开文件。例如，使用 <code>npm run preview</code>。</p>

        <div class="section">
            <h2>1. 基本请求</h2>
            <button id="btn-basic">发送 GET 请求</button>
            <pre id="result-basic"></pre>
        </div>

        <div class="section">
            <h2>2. 文件处理</h2>
            <input type="file" id="file-input">
            <button id="btn-to-base64">转换为 Base64</button>
            <pre id="result-file"></pre>
        </div>
    </div>

    <!-- 使用 type="module" 导入 ES Module -->
    <script type="module">
        // 从构建后的 ES Module 文件中导入默认导出
        import $syncer from '../dist/index.js';

        console.log('导入的 $syncer:', $syncer);

        document.getElementById('btn-basic').addEventListener('click', async () => {
            const resultEl = document.getElementById('result-basic');
            resultEl.textContent = '请求中...';
            try {
                // 直接使用导入的 $syncer
                const result = await $syncer.request('https://jsonplaceholder.typicode.com/posts/1');
                // 将 Blob data 转换为文本以便显示
                const dataText = result.data ? await $syncer.blobToString(result.data) : 'No data';
                resultEl.textContent = JSON.stringify({
                    ...result,
                    data: dataText
                }, null, 2);
            } catch (error) {
                resultEl.textContent = 'Error: ' + error.message;
            }
        });

        document.getElementById('btn-to-base64').addEventListener('click', async () => {
            const fileInput = document.getElementById('file-input');
            const resultEl = document.getElementById('result-file');
            const file = fileInput.files[0];

            if (!file) {
                resultEl.textContent = '请先选择一个文件。';
                return;
            }

            resultEl.textContent = '转换中...';
            try {
                const base64 = await $syncer.toBase64(file);
                resultEl.textContent = `Base64:\n${base64}`;
            } catch (error) {
                resultEl.textContent = 'Error: ' + error.message;
            }
        });
    </script>
</body>

</html>